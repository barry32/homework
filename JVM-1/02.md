#### 02

1. 运行时数据区包含：堆、虚拟机栈、本地方法栈、方法区、运行时常量池

   堆: 储存new出来的对象、也包含运行时常量池、以及字符串常量池

   虚拟机栈：方法调用会压栈、调用结束出栈。最小单位为栈帧，包含本地变量表、操作数栈、动态链接、方法返回地址。本地变量表存放方法的形参和内部定义的变量，如果是实例方法则第一个存放的是this对象。操作数栈：在执行方法对应的字节码的时候会压栈。动态链接：常量池中符号引用替换内存地址。方法返回地址：方法执行结束后，用于恢复现场。

   本地方法栈：用于native方法使用，调用操作系统资源

   方法区：是一种规范，jdk1.8的实现是元空间，用来存储类的元信息

   运行时常量池：编译完成时Class文件常量池，当以二进制流的形式读入到内存中时候，称为运行时常量池每个class只有一个，存储在堆中。

   直接内存：直接在内存空间开辟的空间，大小限制受制于内存大小。而堆内存是在 JVM开辟的空间，被JVM所管理。

2. 为什么堆内存要分年轻代和老年代？

   弱分代假说：大多数对象都是朝生夕灭的。

   强分代假说：经历过多次GC后存活的对象，越不容易被回收。

   如果不区分年轻代和老年代，则所有对象都存放在一个区域里。许多老的对象，每次都会经历GC但是每次都回收不掉，比较浪费垃圾回收的效率。所以需要进行分代回收，将那些不容易回收掉的对象存放到老年代，这样可以提高效率。

3. 对象创建过程

   执行new指令 --> 在常量池中检查该类是否已经加载，使用类加载子系统加载class文件到方法区，然后生成Class对象到堆中 ---> 分配内存空间 ---->变量的默认初始化（int 初始化为0， 引用类型为null）--->设置对象头信息---><init>方法收敛代码块，并执行构造方法的初始化

4. 内存分配

   指针碰撞的方式：在年轻代，内存空间是连续的，分配空间后，指针后移。

   空闲列表：在老年代，使用的是标记--清除算法，内存空间是不连续的，在列表中找到足够容纳大小的空间来分配。

5. 销毁过程

   方法执行结束后，挥着类不再使用卸载的时候，导致引用指针不再指向堆中的对象。当GC的时候，会从GCRoots 检查 没有指针指向会被标记，此时虚拟机会调用finalize方法，之后检查该对象是否又被指针引用，没有的话则被回收。

   

6. 对象的访问方式：

   句柄访问：栈帧中布局变量表中的引用存放的是句柄的地址，句柄存放的是实例对象的地址。使用的是间接访问的形式。比如：CPU访问寄存器，寄存器存放的是内存地址，这样就需要多一次访存，来间接访问。

   直接指针：局部变量表中存放的是实例对象的地址，减少一次访问的操作。只是在垃圾回收的时候，对象内存地址变更需要修改局部变量表的指针指向。

7. 为什么需要内存担保？

   年轻代使用的是复制算法，Survivor区域比Eden区域要小，当触发MinorGC之后，Survivor区域可能存不下回收后的对象。所以需要老年代做担保。

8. 垃圾收集器算法

   复制算法：常见于年轻代，将空间分为两半，每次将存活的对象复制到另一半，这样就可以把前一半的空间直接回收。出现空间的浪费，但是效率高

   标记清除算法：先将对象进行标记，之后再将标记的对象清除。需要清除的对象不一定在内存中是连续的空间，所以会导致内存碎片化。

   标记整理：比在标记清除的基础上，进行整理。解决内存碎片问题。耗时较长

   分代回收：年轻代使用复制算法，老年代使用标记整理、标记清除算法。

9. ParNew

   可以设置GC收集的线程数，设计出来是用来适配CMS的年轻代复制算法垃圾收集器。

10. ParallelScavenge 收集器

    可以和Parallel Old收集器协同使用。当前是吞吐量优先的、年轻代复制算法的支持并行的垃圾收集器

11. ParallelOld 收集器

    采用的是标记整理的算法的、吞吐量优先的、支持并行的老年代垃圾收集器。

12. CMS

    低延时的 标记 清除的老年代垃圾收集器。初始化标记会出发STW，找到所有GCRoots的直接指向对象。

    并发标记阶段，会根据那些直接指向对象，遍历所有路径指向的对象，来进行标记。

    再次标记阶段：会触发STW，来对并发标记阶段时间段产生的对象来做修正。

    并发清除阶段：会清除被标记的对象。

    特点：细分GC的步骤，减少STW的时间。但是会造成内存碎片的问题。

13. G1

    支持老年代和年轻代的回收。将堆分为2048个分区，对于全局使用标记整理算法，对于局部采用复制算法。特点是支持大容量的GC

    

    

    

    

    

    

    

    

    

    